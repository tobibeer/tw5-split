/*\
title: $:/plugins/tobibeer/split/filter.js
type: application/javascript
module-type: filteroperator

Filter operator that splits each item at a specified separator.

@preserve
\*/
(function(){"use strict";exports.split=function(s,t,i){var e,a,n=i.wiki,f=t.suffix||"",r=[],l=[],u=[],p=[],o={negate:t.prefix==="!",split:t.operand,prefix:"",suffix:"",num:1,$num:1},c=[[/^\s+/,function(){}],[/^(num|pos|\$num|\$pos)=(n|-n|\d+|-\d+)(?:\s|$)/i,function(s){o[s[1]]=s[2];if(s[1].charAt(0)==="$"){o.mode="$pos"}if(s[1]==="$num"&&!o.$pos){o.$pos=1}if(s[1]==="num"&&!o.pos){o.pos=1}}],[/^(\+|at|first|!first|last|!last|list|keep|strict|\$strict|trim|unique)(?:\s|$)/i,function(s){var t=s[1];o[t]=1;switch(t){case"+":o.suffix=o.split;break;case"at":e=o.split.match(/(\d+),(\d+)/);if(e){o.at=parseInt(e[1]);o.to=parseInt(e[2])}else{o.at=parseInt(o.split)}if(isNaN(o.at)){throw"suffix 'at' must be numeric: "+o.at}else{o.at=o.at-1}break;case"list":o.list="list";break;case"first":o.pos=1;break;case"!first":o.pos=2;o.num="n";break;case"last":o.pos="n";break;case"!last":o.pos="-2";o.num="-n";break}}],[/^list\=\s*([^\s]+)(?:\s|$)/i,function(s){o.list=s[1]}],[/^(\!)?(\$|\$all|\$first|\$last)(?:\s|$)/i,function(s){var t=s[2];o.mode=t;o.neg=s[1]?1:0;if(t==="$first"){if(o.neg){o.$pos=2;o.$num="n"}else{o.$pos=1}}else if(t==="$last"){if(o.neg){o.$pos="-2";o.$num="-n"}else{o.$pos="n"}}}],[/^(?:\+\\([^\\]+)\\|\\([^\\]+)\\\+)/,function(s){if(s[1]){o.prefix=s[1]}else{o.suffix=s[2]}}]];try{while(f){a=f;$tw.utils.each(c,function(s){var t=s[0].exec(f);if(t){s[1].call(this,t);f=f.substr(t[0].length);return false}});if(f===a){throw"invalid suffix(es) '"+f+"'"}}if(o.list&&o.split){p=$tw.utils.parseStringArray(o.split)}else{s(function(s,t){var i,e,a;l.push(t);if(o.at){if(o.to){a=[t.substr(o.at,o.to)];if(o.keep||t.length>o.at+o.to){e=t.substr(0,o.at)+t.substr(o.at+o.to);if(e){a.push(e)}}}else{a=[t.substr(0,o.at)];e=t.substr(o.at);if(e){a.push(e)}}}else if(o.list){a=n.getTiddlerList(t,o.list)}else{a=t.split(o.split)}i=a.length>1||o.list;if(o.pos){a=$tw.utils.getArrayItems(a,o.pos,o.num,o.strict)}if(a.length&&(i||o.keep)){r.push(t);$tw.utils.each(a,function(s){if(o.trim){s=s.trim()}if(s){if(!o.unique||o.unique&&p.indexOf(s)<0){p.push(o.prefix+s+o.suffix)}}})}else{u.push(t)}})}if(t.suffix){switch(o.mode){case"$":p=r;break;case"$all":if(p.length){if(o.negate){u=[]}else{p=l}}else if(o.negate){u=l}break;case"$first":case"$last":case"$pos":p=$tw.utils.getArrayItems(p,o.$pos,o.$num,o.$strict);break}}}catch($){return["split syntax error:"+$]}return o.negate?u:p}})();